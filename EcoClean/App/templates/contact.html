{% load static %}

{%block content%}
<script>
    function isInteger(value) {
        const parsedValue = parseInt(value, 10); 
        return Number.isInteger(parsedValue);
    }
    async function validate_zipcode() {
        const zipCode = document.getElementById('id_codes').value.trim(); 
        const resultElement = document.getElementById('check-result');
        console.log(zipCode);
    
        if (!zipCode) {
            resultElement.textContent = 'ZIP code is required.';
            return;
        }
    
        if (!isInteger(zipCode)) {
            resultElement.textContent = 'Please enter a valid integer zip code.';
            return;
        }
        const zipCodeInt = parseInt(zipCode, 10);
    
        try {
            const response = await fetch(`/check-zip-code/?code=${zipCodeInt}`);
            const result = await response.json();
            if (response.ok) {
                const message = result.exists ? 'We service this area!' : 'Sorry, we do not service this area.';
                resultElement.textContent = message;
            } else {
                resultElement.textContent = 'Error: ' + (result.error ? result.error : 'Unknown error occurred.');
            }
        } catch (error) {
            resultElement.textContent = 'Error: ' + error.message;
        }
    }

    const submit_button = document.getElementById("form_submit_button");
    submit_button.addEventListener("click", ()=> {
        console.log("clicked");
        validate_zipcode();
    });
    
</script>

<title>ZIP Code Validation</title>
<form method="post" action="{% url 'check_zip_code' %}">
    {% csrf_token %}
    <label for="zipcode">ZIP Code:</label>
    <input type="text" id="id_codes" name="code" placeholder="Enter zip code" required>
    <button id = "form_submit_button" type="button">Check</button>
</form>
<p id="check-result"></p>
{%endblock content%}